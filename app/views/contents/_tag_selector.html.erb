<div data-controller="tag-modal" class="space-y-4">
  <button type="button"
          data-action="click->tag-modal#open"
          class="px-4 py-2 text-gray-800 border border-gray-800 rounded-none bg-white hover:bg-gray-100 transition-all duration-200">
    <%= t('.select_tags_btn') %>
  </button>

  <div class="flex flex-wrap gap-2" data-tag-modal-target="selectedTags">
    <% @tags.each do |tag| %>
      <% if @content.tag_ids.include?(tag.id) %>
        <span class="px-2 py-1 border border-gray-800 bg-gray-100 text-sm text-gray-800 rounded-none">
          <%= tag.name %>
        </span>
      <% end %>
    <% end %>
  </div>

  <% @tags.each do |tag| %>
    <%= hidden_field_tag "content[tag_ids][]", tag.id,
        id: "tag-hidden-#{tag.id}",
        data: { tag_modal_target: "hiddenTag", tag_id: tag.id },
        disabled: !@content.tag_ids.include?(tag.id) %>
  <% end %>

  <div id="tag-modal"
       class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm"
       data-tag-modal-target="modal">
    <div class="bg-white max-w-lg w-full p-6 rounded-none border-2 border-gray-800 shadow-xl overflow-y-auto max-h-[80vh] space-y-6">
      <h2 class="text-xl font-bold text-gray-900 border-b border-gray-300 pb-2">
        <%= t('.select_tags_title') %>
      </h2>

      <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
        <% @tags.each do |tag| %>
          <label class="flex items-center gap-2 text-gray-800 text-sm">
            <input type="checkbox"
                   value="<%= tag.id %>"
                   data-action="tag-modal#toggle"
                   data-tag-id="<%= tag.id %>"
                   class="accent-gray-800 w-4 h-4"
                   <%= 'checked' if @content.tag_ids.include?(tag.id) %>>
            <span><%= tag.name %></span>
          </label>
        <% end %>
      </div>

      <div class="flex justify-end gap-4 pt-4 border-t border-gray-300">
        <button type="button"
                data-action="click->tag-modal#confirm"
                class="px-4 py-2 bg-gray-800 text-white font-semibold rounded-none hover:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-800 transition">
          <%= t('.save') %>
        </button>

        <button type="button"
                data-action="click->tag-modal#close"
                class="px-4 py-2 text-red-600 hover:underline">
          <%= t('.cancel') %>
        </button>
      </div>
    </div>
  </div>
</div>
